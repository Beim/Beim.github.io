<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
    
  
  <link href="https://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






  

<link href="https://cdn.bootcss.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="notes," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="0tcp报文中的 Timestamp optionTimestamp value 和 Timestamp echo 作用
网络协议的三要素(语法,语义,同步)
网络工程中常用的线缆标准为568A(直通线568A-568A)(交叉线568A-568B)
IEEE 802.3 CMSA/CD, IEEE 802.4 Token Bus, IEEE 802.5 Token Ring多路访问协议(mult">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机网络-笔记">
<meta property="og:url" content="https://beim.github.io/2016/09/11/计算机网络-笔记/index.html">
<meta property="og:site_name" content="北冥945">
<meta property="og:description" content="0tcp报文中的 Timestamp optionTimestamp value 和 Timestamp echo 作用
网络协议的三要素(语法,语义,同步)
网络工程中常用的线缆标准为568A(直通线568A-568A)(交叉线568A-568B)
IEEE 802.3 CMSA/CD, IEEE 802.4 Token Bus, IEEE 802.5 Token Ring多路访问协议(mult">
<meta property="og:updated_time" content="2016-11-11T10:33:46.890Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="计算机网络-笔记">
<meta name="twitter:description" content="0tcp报文中的 Timestamp optionTimestamp value 和 Timestamp echo 作用
网络协议的三要素(语法,语义,同步)
网络工程中常用的线缆标准为568A(直通线568A-568A)(交叉线568A-568B)
IEEE 802.3 CMSA/CD, IEEE 802.4 Token Bus, IEEE 802.5 Token Ring多路访问协议(mult">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="https://beim.github.io/2016/09/11/计算机网络-笔记/"/>

  <script type="text/javascript" src="/js/src/beim/test.js"></script>

  <title> 计算机网络-笔记 | 北冥945 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">北冥945</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                计算机网络-笔记
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-09-11T00:35:25+08:00" content="2016-09-11">
              2016-09-11
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/11/计算机网络-笔记/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/11/计算机网络-笔记/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/09/11/计算机网络-笔记/" class="leancloud_visitors" data-flag-title="计算机网络-笔记">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">visitors </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="0"><a href="#0" class="headerlink" title="0"></a>0</h1><p><strong>tcp报文中的 Timestamp option</strong><br><a href="http://stackoverflow.com/questions/2524511/what-is-the-meaning-of-the-tsv-and-tser-fields-in-an-ethereal-dump" target="_blank" rel="external">Timestamp value 和 Timestamp echo 作用</a></p>
<p><code>网络协议的三要素</code>(语法,语义,同步)</p>
<p><code>网络工程中常用的线缆标准为568A</code>(直通线568A-568A)(交叉线568A-568B)</p>
<p><code>IEEE 802.3 CMSA/CD, IEEE 802.4 Token Bus, IEEE 802.5 Token Ring</code><br>多路访问协议(multi-access protocol)</p>
<ul>
<li>信道划分协议(TDM, FDM)</li>
<li>随机接入协议<ul>
<li>ALOHA (纯ALOHA, 分槽ALOHA(slotted ALOHA))</li>
<li>载波侦听多路访问协议(CSMA) (坚持)(非坚持)(带冲突检测的CSMA: CSMA/CD)</li>
</ul>
</li>
<li>轮流协议 <ul>
<li>polling</li>
<li>令牌传递(token passing)(令牌总线, 令牌环)</li>
</ul>
</li>
</ul>
<p><code>[ATM](https://zh.wikipedia.org/wiki/%E5%BC%82%E6%AD%A5%E4%BC%A0%E8%BE%93%E6%A8%A1%E5%BC%8F)(Asynchronous Transfer Mode)异步传输模式</code>, 又叫信元中继, ATM采用电路交换的模式, 能够支持有连接和无连接的业务, 能比较理想的实现各种QoS</p>
<p><a href="https://zh.wikipedia.org/wiki/%E5%89%8D%E5%90%91%E9%8C%AF%E8%AA%A4%E6%9B%B4%E6%AD%A3" target="_blank" rel="external">前向纠错(forward err correction)</a></p>
<p><a href="https://zh.wikipedia.org/wiki/%E5%BE%AA%E7%92%B0%E5%86%97%E9%A4%98%E6%A0%A1%E9%A9%97" target="_blank" rel="external">循环冗余校验(CRC: Cyclic redundancy check)</a></p>
<p><a href="http://baike.baidu.com/view/793550.htm" target="_blank" rel="external">混合差错控制</a></p>
<p><a href="https://zh.wikipedia.org/wiki/%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E6%8E%A7%E5%88%B6" target="_blank" rel="external">HDLC: High-Level Data Link Control高级数据链路控制–数据链路层</a></p>
<p>局域网3要素: 传输介质, 拓扑结构, 介质访问控制方法</p>
<p>路由选择算法分为两大类, 分别为<code>适应性</code>和<code>非适应性</code>.<br>理想的路由算法应该具有的特点<em>正确性</em>, <em>简单性</em>, <em>坚定性</em>, 稳定性<em>, 公平性</em>, <em>最佳性</em>.<br>数据报服务中, 网络节点要为每个<em>分组</em>选择路由, 在虚电路服务中, 网络节点只在连接<em>建立</em>时选择路由<br>网络互联时一般要使用网络互联器, 根据网络互联器进行协议和功能转换对象的不同可以分为: <code>中继器 网桥 路由器 协议转换器</code> 四种</p>
<p><a href="https://en.wikipedia.org/wiki/Exponential_backoff#Binary_exponential_backoff_.2F_truncated_exponential_backoff" target="_blank" rel="external">CSMA/CD采用的二进制指数退避算法</a></p>
<p><a href="https://en.wikipedia.org/wiki/Synchronous_Data_Link_Control" target="_blank" rel="external">SDLC: Synchronous Data Link Control – layer 2, 现在已经逐渐被IP协议取代</a></p>
<h2 id="答案暂存"><a href="#答案暂存" class="headerlink" title="答案暂存"></a>答案暂存</h2><p>1-5 B A A A C<br>6-10 C D C C B<br>11-15 D B A A B<br>16-20 D A C D C </p>
<p>36页开始</p>
<p>一,填空题</p>
<ol>
<li>自治系统内路由, 自治系统外路由. 自适应性, 鲁棒性, </li>
<li>报文, 建立.</li>
<li>语法, 语义, 时序</li>
<li>物理层, 链路层, 网络层</li>
<li>总线, 交换机, 网桥, 路由器<br>二, 选择题<br>1-5 A D B B C<br>6-10 C A B<br>三, 简答题</li>
<li>1, 0-L, L, 传输失败</li>
<li>5微秒, 10微秒<br>四, 计算题</li>
<li>2400 <em> 30 = 7.2 </em> 10^4, 每个汉字16bit, 4.5*10^3</li>
<li>194.47.21.136  C类 254台</li>
</ol>
<hr>
<h1 id="计算机网络5E"><a href="#计算机网络5E" class="headerlink" title="计算机网络5E"></a>计算机网络5E</h1><h2 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h2><ul>
<li><p><strong>IP</strong> (Internet Protocol) 因特网协议</p>
</li>
<li><p><strong>ICMP</strong> (Internet Control Message Protocol) 因特网控制报文协议</p>
</li>
<li><p><strong>TCP</strong> (Transport Control Protocol) 传输控制协议</p>
</li>
<li><p><strong>UDP</strong> (User Datagram Protocol) 用户数据报协议</p>
</li>
<li><p><strong>Internet</strong> 因特网</p>
</li>
<li><p><strong>internet</strong> 互联网</p>
</li>
<li><p><strong>NAP</strong> (Network Access Point) 网络接入点</p>
</li>
<li><p><strong>DSL</strong> (Digital Subscriber Line) 数字用户线</p>
</li>
</ul>
<a id="more"></a>
<ul>
<li><p><strong>SMTP</strong> (Simple Mail Transfer Protocol) 简单邮件传输协议</p>
</li>
<li><p><strong>POP3</strong> (Post Office Protocol) 邮局协议版本3</p>
</li>
<li><p><strong>HTTP</strong> (HyperText Transfer Protocol) 超文本传输协议</p>
</li>
<li><p><strong>URL</strong> (Uniform Resource Locator) 统一资源定位符</p>
</li>
<li><p><strong>CDN</strong> (Content Dilivery Network) 内容分发网络</p>
</li>
<li><p><strong>P2P</strong> (Peer-to-Peer) 对等网络</p>
</li>
</ul>
<hr>
<h2 id="报文格式"><a href="#报文格式" class="headerlink" title="报文格式"></a>报文格式</h2><p><strong>ICMP</strong></p>
<p>Type(1) Code(1) Checksum(2)<br>(这4 个字节取决于ICMP 报文的类型)<br>(ICMP 的数据部分, (长度取决于类型))</p>
<p><strong>Ethernet frame</strong></p>
<p>preamble(8) des-address(6) source-address(6) type(2) data(payload)(46-1500) CRC(4)</p>
<p><strong>PPP Data Frame</strong></p>
<p>flag(1) address(1) control(1) protocol(1 or 2) info(variable) check(2 or 4) flag(1)</p>
<p>flag: delimiter<br>Address: does nothing<br>Control: does nothing, in the future possible multiple control fields<br>Protocol: upper layer protocol<br>info: upper layer data being carried<br>check: cyclic redundancy check for error detection</p>
<p><strong>ARP</strong><br>Hardware type: Ethernet<br>protocol type: IPv4<br>Hardware size: 6<br>Protocol size: 4<br>Opcode: request<br>Sender MAC address: d4:ee:07:0e:b7:ec<br>Sender IP address: 192.168.10.122<br>Target MAC address: 00:00:00:00:00:00<br>Target IP address: 192.168.10.10</p>
<hr>
<h2 id="OSI参考模型"><a href="#OSI参考模型" class="headerlink" title="OSI参考模型"></a>OSI参考模型</h2><ul>
<li><p><strong>物理层(physical layer)</strong> 关注在一条通信信道上传输原始比特。</p>
</li>
<li><p><strong>数据链路层(data link layer)</strong> 的主要任务是将一个原始的传输设施转变成一条没有漏检传输错误的线路。将真实的错误掩盖，使网络层看不到。为此，发送方将输入的数据拆分成<strong>数据帧(data frame)</strong>，则接受方必须确认正确收到每一帧，即给发送方返回一个<strong>确认帧(acknowledgement frame)</strong>。</p>
</li>
<li><p><strong>网络层(network layer)</strong> 的主要功能是控制子网的运行。关键问题是将数据包从源端路由到接受方。处理拥塞也是网络层的责任，一般还要和高层协议结合起来处理拥塞才有效。</p>
</li>
<li><p><strong>传输层(transport layer)</strong> 的基本功能是接受来自上一层的数据，在必要的时候把这些数据分隔成较小的单元，然后把这些数据单元传递给网络层，并且确保这些数据单元正确地到达另一端。</p>
</li>
<li><p><strong>会话层(session layer)</strong> 允许不同机器上的用户建立会话。会话通常提供各种服务，包括<strong>对话控制(dialog control)</strong>(记录该由谁来传递数据)、<strong>令牌管理(token management)</strong>(禁止双方同时执行同一个关键操作)，以及<strong>同步功能(synchronization)</strong>(在一个长传输过程中设置一些断点，以便在系统崩溃之后还能回复到崩溃前的状态继续运行)。</p>
</li>
<li><p><strong>表示层(presentation layer)</strong> 表示层以下的各层关注如何传递数据位，而表示层关注的是所传递信息的语法和语义。不同的计算机可能有不同的内部数据表示法，为了让这些计算机能够进行通信，它们所交换的数据结构必须以一种抽象的方式来定义，同时还应定义一种“线上”使用的标准编码方法。表示层管理这些抽象的数据结构，并允许定义和交换更高层的数据结构（比如银行账户记录）。</p>
</li>
<li><p><strong>应用层(application layer)</strong> 包含了用户通常需要的各种各样的协议。一个得到广泛使用的应用协议是<strong>超文本传输协议(HTTP, HyperText Transfer Protocol)</strong>，它是<strong>万维网</strong>的基础。其他一些应用协议可用于文件传输、电子邮件以及网络新闻等。</p>
</li>
</ul>
<hr>
<h2 id="TCP-IP-参考模型"><a href="#TCP-IP-参考模型" class="headerlink" title="TCP/IP 参考模型"></a>TCP/IP 参考模型</h2><h3 id="设计目标"><a href="#设计目标" class="headerlink" title="设计目标"></a>设计目标</h3><ul>
<li>以无缝的方式将多个网络链接起来。</li>
<li>即使在损失子网硬件的情况下网络还能够继续工作，原有的会话不能被打断。</li>
</ul>
<h3 id="模型结构"><a href="#模型结构" class="headerlink" title="模型结构"></a>模型结构</h3><ul>
<li><p><strong>链路层(link layer)</strong> 该层描述了链路必须王城什么功能才能满足无连接的互连网络层的需求，比如串行线和经典以太网链路。在分层协议的上下文中，链路层并不是通常意义上的一层。它是一个接口（位于网络层和数据链路层之间）。</p>
</li>
<li><p><strong>互联网层(internet layer)</strong> 是将整个网络体系结构贯穿在一起的关键层。它大致对应OSI 的网络层。互联网层的任务是将IP 分组投递到它们该去的地方。数据包的路由是这里最主要的问题，同时该层还要考虑拥塞控制问题。</p>
</li>
<li><p><strong>传输层(transport layer)</strong> 的设计目标是允许源主机和目标主机上的对等实体进行对话，犹如OSI 的传输层一样。这里定义了两个端到端的协议TCP 和UDP。</p>
</li>
<li><p><strong>应用层(application layer)</strong> 包含了所有的高层协议。如虚拟终端协议（TELNET）、文件传输协议（FTP）、电子邮件协议（SMTP）、DNS（Domain Name System）、HTTP以及用于传送实时媒体的RTP 等。</p>
</li>
</ul>
<h3 id="TCP-IP-模型及协议"><a href="#TCP-IP-模型及协议" class="headerlink" title="TCP/IP 模型及协议"></a>TCP/IP 模型及协议</h3><ul>
<li><p><strong>应用层</strong>  HTTP  SMTP  RTP  DNS</p>
</li>
<li><p><strong>传输层</strong>  TCP  UDP</p>
</li>
<li><p><strong>互联网层</strong> IP ICMP</p>
</li>
<li><p><strong>链路层</strong>  DSL  SONET  802.11  Ethernet</p>
</li>
</ul>
<hr>
<h2 id="套接字编程实例-Internet-文件服务器"><a href="#套接字编程实例-Internet-文件服务器" class="headerlink" title="套接字编程实例: Internet 文件服务器"></a>套接字编程实例: Internet 文件服务器</h2><blockquote>
<p>server.c</p>
</blockquote>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/fcntl.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netdb.h&gt;</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">void</span> fatal (<span class="keyword">char</span> *<span class="keyword">string</span>) &#123;</div><div class="line">    printf(<span class="string">"%s\n"</span>, <span class="keyword">string</span>);</div><div class="line">    exit(<span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SERVER_PORT 12345</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BUF_SIZE 4096</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> QUEUE_SIZE 10</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> main (<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[]) &#123;</div><div class="line">    <span class="keyword">int</span> s, b, l, fd, sa, bytes, on = <span class="number">1</span>;</div><div class="line">    <span class="keyword">char</span> buf[BUF_SIZE];</div><div class="line">    <span class="keyword">struct</span> sockaddr_in channel;</div><div class="line"></div><div class="line">    memset(&amp;channel, <span class="number">0</span>, <span class="keyword">sizeof</span>(channel));</div><div class="line">    channel.sin_family = AF_INET;</div><div class="line">    channel.sin_addr.s_addr = htonl(INADDR_ANY);</div><div class="line">    channel.sin_port = htons(SERVER_PORT);</div><div class="line"></div><div class="line">    s = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);</div><div class="line">    <span class="built_in">if</span> (s &lt; <span class="number">0</span>)  fatal(<span class="string">"socket failed"</span>);</div><div class="line">    setsockopt(s, SOL_SOCKET, SO_REUSEADDR, (<span class="keyword">char</span> *) &amp;on, <span class="keyword">sizeof</span>(on));</div><div class="line">    b = bind(s, (<span class="keyword">struct</span> sockaddr *) &amp;channel, <span class="keyword">sizeof</span>(channel));</div><div class="line">    <span class="built_in">if</span> (b &lt; <span class="number">0</span>) fatal(<span class="string">"bind failed"</span>);</div><div class="line"></div><div class="line">    l = <span class="built_in">listen</span>(s, QUEUE_SIZE);</div><div class="line">    <span class="built_in">if</span> (l &lt; <span class="number">0</span>) fatal(<span class="string">"listen failed"</span>);</div><div class="line"></div><div class="line">    <span class="built_in">while</span> (<span class="number">1</span>) &#123;</div><div class="line">        sa = accept(s, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        <span class="built_in">if</span> (sa &lt; <span class="number">0</span>) fatal(<span class="string">"accept failed"</span>);</div><div class="line">        <span class="built_in">read</span>(sa, buf, BUF_SIZE);</div><div class="line"></div><div class="line">        fd = <span class="built_in">open</span>(buf, O_RDONLY);</div><div class="line">        <span class="built_in">if</span> (fd &lt; <span class="number">0</span>) &#123;</div><div class="line">            fatal(<span class="string">"open failed"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">while</span> (<span class="number">1</span>) &#123;</div><div class="line">            bytes = <span class="built_in">read</span>(fd, buf, BUF_SIZE);</div><div class="line">            <span class="built_in">if</span> (bytes &lt;= <span class="number">0</span>) <span class="built_in">break</span>;</div><div class="line">            <span class="built_in">write</span>(sa, buf, bytes);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">close</span>(fd);</div><div class="line">        <span class="built_in">close</span>(sa);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>client.c</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netdb.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">fatal</span> <span class="params">(<span class="keyword">char</span> *<span class="built_in">string</span>)</span> </span>&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, <span class="built_in">string</span>);</div><div class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SERVER_PORT 12345</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BUF_SIZE  4096</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> c, s, bytes;</div><div class="line">    <span class="keyword">char</span> buf[BUF_SIZE];</div><div class="line">    <span class="keyword">struct</span> hostent *h;</div><div class="line">    <span class="keyword">struct</span> sockaddr_in channel;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (argc != <span class="number">3</span>) fatal(<span class="string">"Usage: client server-name filename"</span>);</div><div class="line">    h = gethostbyname(argv[<span class="number">1</span>]);</div><div class="line">    <span class="keyword">if</span> (!h) fatal(<span class="string">"gethostbyname failed"</span>);</div><div class="line">    s = socket(PF_INET, SOCK_STREAM, IPPROTO_TCP);</div><div class="line">    <span class="keyword">if</span> (s &lt; <span class="number">0</span>) fatal(<span class="string">"socket"</span>);</div><div class="line">    <span class="built_in">memset</span>(&amp;channel, <span class="number">0</span>, <span class="keyword">sizeof</span>(channel));</div><div class="line">    channel.sin_family = AF_INET;</div><div class="line">    <span class="built_in">memcpy</span>(&amp;channel.sin_addr.s_addr, h-&gt;h_addr, h-&gt;h_length);</div><div class="line">    channel.sin_port = htons(SERVER_PORT);</div><div class="line"></div><div class="line">    c = connect(s, (<span class="keyword">struct</span> sockaddr *) &amp;channel, <span class="keyword">sizeof</span>(channel));</div><div class="line">    <span class="keyword">if</span> (c &lt; <span class="number">0</span>) fatal(<span class="string">"connect failed"</span>);</div><div class="line"></div><div class="line">    write(s, argv[<span class="number">2</span>], <span class="built_in">strlen</span>(argv[<span class="number">2</span>]) + <span class="number">1</span>);</div><div class="line"></div><div class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</div><div class="line">        bytes = read(s, buf, BUF_SIZE);</div><div class="line">        <span class="keyword">if</span> (bytes &lt;= <span class="number">0</span>) <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">        write(<span class="number">1</span>, buf, bytes);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="路由算法"><a href="#路由算法" class="headerlink" title="路由算法"></a>路由算法</h2><p><strong>最短路径算法</strong></p>
<p><strong>泛洪算法</strong><br>对多数情况是不适用的, 但是还有某些重要用途.<br>如广播和无线网络.</p>
<p><strong>距离矢量路由算法</strong>(Bellman-Ford算法)<br>无穷计算问题</p>
<p><strong>链路状态路由算法</strong>(Dijkstra算法)<br>被广泛应用与实际网络中</p>
<p><strong>层次路由</strong></p>
<p><strong>广播路由</strong><br>逆向路径转发</p>
<p><strong>组播路由</strong></p>
<hr>
<h1 id="计算机网络课程"><a href="#计算机网络课程" class="headerlink" title="计算机网络课程"></a>计算机网络课程</h1><h2 id="第二周-1-4计算机网络性能"><a href="#第二周-1-4计算机网络性能" class="headerlink" title="第二周-1.4计算机网络性能"></a>第二周-1.4计算机网络性能</h2><p><strong>速率</strong>即数据率(data rate) 或称数据传输率或比特率(bit rate)<br>单位 b/s(或bps), kb/s, Mb/s, Gb/s<br>k = 10^3, M = 10^ 6, G = 10^9<br>速率往往是指<strong>额定速率</strong>或<strong>标称速率</strong></p>
<p><strong>带宽</strong>(bandwidth) 是指信号具有的频带宽度，即最高频率与最低频率之差，单位是赫兹(Hz)<br>网络中的<strong>带宽</strong>是数字型号所能传送的<strong>最高数据率</strong>, 单位 b/s(bps)<br>常用的带宽单位:<br>kb/s(10^3 b/s), Mb/s, Gb/s, Tb/s</p>
<p>Q: 分组交换为什么会发生丢包和时延?<br>A: 分组在路由器缓存中排队</p>
<h3 id="四种分组延迟"><a href="#四种分组延迟" class="headerlink" title="四种分组延迟"></a>四种分组延迟</h3><ul>
<li><code>结点处理延迟</code>(nodal processing delay)</li>
<li><code>排队延迟</code>(queueing delay)<br>R: 链路带宽(bps)<br>L: 分组长度(bits)<br>a: 平均分组到达速率<br>流量强度: La / R (接近1: 平均排队延迟大, 约等于0: 平均排队延迟很小, 大于1: 超出服务能力,平均排队延迟无限大)</li>
<li><code>传输延迟</code>(transmission delay)<br>L: 分组长度(bits)<br>R: 链路带宽(bps)<br>d = L / R</li>
<li><code>传播延迟</code>(propagation delay)<br>d: 物理链路长度<br>s: 信号传播速度(~2 * 10^8 m/sec)<br>dprop = d / s</li>
</ul>
<p><strong>时延带宽积</strong> = 传播时延 * 带宽 = d * R (bits)<br>链路的时延带宽积又称为<code>以比特为单位的链路长度</code></p>
<p><strong>分组丢失(丢包)</strong> <code>丢包率</code> = 丢包数 / 已发分组总数</p>
<ul>
<li>队列缓存容量有限</li>
<li>分组到达已满队列将被丢弃</li>
<li>丢弃分组可能由前序节点或源重发(也可能不重发)</li>
</ul>
<p><strong>吞吐量/率(Throughput)</strong> : 表示在发送端与接受端之间传送数据速率(b/s)</p>
<ul>
<li>即时吞吐量: 给定时刻的速率</li>
<li>平均吞吐量: 一段时间的平均速率</li>
</ul>
<h2 id="第5周-传输层-上"><a href="#第5周-传输层-上" class="headerlink" title="第5周 传输层(上)"></a>第5周 传输层(上)</h2><p><strong>接收端进行多路分用</strong><br>传输层依据头部信息将收到的Segment 交给正确的Socket ,即不同的进程.</p>
<p><strong>发送端进行多路复用</strong><br>从多个Socket 接收数据,为每个数据封装上头部信息,生成Segment ,交给网络层.</p>
<h3 id="UDP-校验和-checksum"><a href="#UDP-校验和-checksum" class="headerlink" title="UDP 校验和(checksum)"></a>UDP 校验和(checksum)</h3><p><a href="http://m.blog.csdn.net/article/details?id=48268927" target="_blank" rel="external">csdn-二进制反码求和校验酸反</a></p>
<p><strong>发送方</strong><br>将段的内容视为16-bit 整数<br>计算所有整数的和,进位加在和的后面,将得到的值按位取反,得到校验和<br>发送方将校验和放入校验和字段</p>
<p><strong>接收方</strong><br>计算所收到段的校验和<br>将其与校验和字段进行对比<br>不相等: 检测出错误<br>相等: 没有检测出错误(但可能有错误)</p>
<p><strong>栗子</strong><br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">两个整数</div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span></div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span></div><div class="line"></div><div class="line">求和得到</div><div class="line"><span class="number">1</span>(进位) <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span></div><div class="line"></div><div class="line">将进位的<span class="number">1</span> 加到末位得到</div><div class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> </div><div class="line"></div><div class="line">按位取反得到checksum</div><div class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span></div></pre></td></tr></table></figure></p>
<p><strong>可靠数据传输</strong><br>不错\不丢\不乱</p>
<h2 id="第6周-传输层-下"><a href="#第6周-传输层-下" class="headerlink" title="第6周 传输层(下)"></a>第6周 传输层(下)</h2><p><a href="https://blog.json.tw/introduction-to-computer-network-gbn-sr-tcp-compare" target="_blank" rel="external">GBN, SR, TCP 重传机制的比较</a></p>
<p>TCP - Tahoe : </p>
<pre><code>1. slow-start, 每收到一个ACK, 拥塞窗口cwnd值加一, 因此每过一个RTT, cwnd翻倍
2. 当cwnd超过慢启动阙值(slow start threshold)ssthresh时, cwnd停止slow-start, 开始线性增长.
3. 当发生超时或者快速重传(收到三次重复确认)时, ssthresh = cwnd / 2, cwnd = 1; 重新开始slow-start 过程
</code></pre><p>TCP - Reno</p>
<pre><code>1. slow-start
2. 当cwnd超过ssthresh时, cwnd停止slow-start, 开始线性增长
3. 当发生快速重传时, 进入快速恢复(fast recovery), ssthresh = cwnd / 2; cwnd = ssthresh; 
4. 当发生超时, ssthresh = cwnd / 2; cwnd = 1; 重新开始slow-start 过程
</code></pre><h2 id="第7周-网络层-上"><a href="#第7周-网络层-上" class="headerlink" title="第7周 网络层(上)"></a>第7周 网络层(上)</h2><p><strong>IP分组格式</strong></p>
<p>标志位 占3位, [保留, DF, MF]<br>DF(Don’t Fragment) {1: 禁止分片, 0: 允许分片}<br>MF(More Fragment) {1: 非最后一片, 0: 最后一片(或未分片)}</p>
<p>片偏移 字段占13位: 一个IP分组分片封装原IP 分组数据的相对偏移量<br>片偏移字段以<code>8 字节为单位</code></p>
<p>假设原IP 分组总长度L, 待转发链路的MTU(最大传输单元)为M<br>若L&gt;M, 且DF = 0, 则可以/需要分片<br>分片时每个分片的标识复制原IP 分组的标识<br>通常分片时, 除了最后一个分片, 其他分片均为MTU 允许的最大分片<br>一个最大分片可封装的数据应该是8 的倍数, 因此, 一个最大分片可以封装的数据为<br><code>d = [(M - 20) / 8] * 8    // 向下取整</code><br>需要的总片数为<br><code>n = [(L - 20) / d]   // 向上取整</code><br>每片的片偏移量字段的取值为<br><code>Fi = d / 8 * (i - 1) , 1 &lt;= i &lt;= n</code><br>每片总长度字段为<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Li = &#123;</div><div class="line">    d + <span class="number">20</span> , <span class="number">1</span> &lt;= <span class="selector-tag">i</span> &lt; n</div><div class="line">    L - (n - <span class="number">1</span>)d , <span class="selector-tag">i</span> = n</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>特殊IP地址</strong> (ipv4)</p>
<table>
<thead>
<tr>
<th>NetID</th>
<th>HostID</th>
<th>作为IP 分组源地址</th>
<th>作为IP 分组目的地址</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>全0</td>
<td>全0</td>
<td>可以</td>
<td>不可以</td>
<td>在本网范围内表示本机, 在路由表中用于表示默认路由(相当于表示整个Internet网络)</td>
</tr>
<tr>
<td>全0</td>
<td>特定值</td>
<td>不可以</td>
<td>可以</td>
<td>表示本网内某个特定主机</td>
</tr>
<tr>
<td>全1</td>
<td>全1</td>
<td>不可以</td>
<td>可以</td>
<td>本网广播地址(路由器不转发)</td>
</tr>
<tr>
<td>特定值</td>
<td>全0</td>
<td>不可以</td>
<td>不可以</td>
<td>网络地址, 表示一个网络</td>
</tr>
<tr>
<td>特定值</td>
<td>全1</td>
<td>不可以</td>
<td>可以</td>
<td>直接广播地址, 对特定网络上所有主机进行广播</td>
</tr>
<tr>
<td>127</td>
<td>非全0 或非全1 的任何数</td>
<td>可以</td>
<td>可以</td>
<td>用于本地软件环回测试, 称为环回测试</td>
</tr>
</tbody>
</table>
<p><strong>私有IP地址</strong> (ipv4)</p>
<table>
<thead>
<tr>
<th>Class</th>
<th>NetIDs</th>
<th>Blocks</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>10</td>
<td>1</td>
</tr>
<tr>
<td>B</td>
<td>172.16 to 172.31</td>
<td>16</td>
</tr>
<tr>
<td>C</td>
<td>192.168.0 to 192.168.255</td>
<td>256</td>
</tr>
</tbody>
</table>
<p><strong>子网掩码的应用</strong></p>
<p>将IP分组的目的IP地址与子网掩码按位与运算, 提取子网地址<br>例如:目的地址: 172.32.1.112, 子网掩码: 255.255.254.0<br>172.32.1.112 =   10101100 00100000 00000001 01110000<br>255.255.254.0 =  11111111 11111111 11111110 00000000<br>与运算 = 10101100 00100000 00000000 00000000 = 172.32.0.0</p>
<p>所以:<br>子网地址: 172.32.0.0 (子网掩码: 255.255.254.0)<br>地址范围: 172.32.0.0 ~ 172.32.1.255<br>可分配地址范围: 172.32.0.1 ~ 172.32.1.254<br>广播地址: 172.32.1.255</p>
<h2 id="第8周-网络层-下"><a href="#第8周-网络层-下" class="headerlink" title="第8周 网络层(下)"></a>第8周 网络层(下)</h2><p>主机如何获得IP地址</p>
<ul>
<li>硬编码 - 静态配置</li>
<li>动态主机配置协议 DHCP - 从服务器动态获取</li>
</ul>
<p>网络地址转换<strong>NAT</strong><br>内部网络设备对外界网络不可见</p>
<p>NAT穿透问题解决方案</p>
<ul>
<li>静态配置NAT, 将特定端口的连接请求转发给服务器</li>
<li>利用UPnP(Universal Plug and Play)互联网网关设备协议(IGD- Internet Gateway Device), 自动配置: 学习到NAT公共IP地址</li>
<li>中继(如 skype)</li>
</ul>
<p>互联网控制报文协议(<strong>ICMP</strong>)</p>
<ul>
<li>差错(或异常)报告</li>
<li>网络探寻</li>
</ul>
<p><strong>距离向量路由算法</strong></p>
<p><strong>链路状态路由算法</strong></p>
<p><strong>RIP协议(Routing Information Protocol)</strong>(AS内)(使用距离向量路由算法)(使用UDP)</p>
<p><strong>OSPF协议(Open Shortest Path First)</strong>(AS内)(使用链路状态路由算法)</p>
<p><strong>BGP协议(Border Gateway Protocol)</strong>(AS间)(使用TCP)<br>AS间: eBGP<br>AS内: iBGP<br>前缀: 到达某些AS需要经过的路径<br>前缀的属性: AS-PATH, NEXT-HOP<br>BGP路由选择: 输入策略(import policy)(如: 政策问题禁止将流量路由到某个AS)<br>为什么AS间和AS内的路由协议不同?(<code>策略</code>policy, <code>规模</code>scale, <code>性能</code>performance)</p>
<h2 id="链路层"><a href="#链路层" class="headerlink" title="链路层"></a>链路层</h2><h3 id="链路层服务"><a href="#链路层服务" class="headerlink" title="链路层服务:"></a>链路层服务:</h3><ul>
<li><code>组侦framing</code>(封装数据报构成数据帧, 加首部和尾部)( 帧同步); </li>
<li><code>链路接入link access</code>(如果是共享介质, 需要解决信道接入channel access)(帧首部的MAC地址, 用于表示帧的源和目的)</li>
<li><code>相邻结点间可靠交付</code>(在低误码率的有线链路上很少采用, 如光纤,某些双绞线等)(无线链路: 误码率高,需要可靠交付)</li>
<li><code>流量控制</code>(协调相邻的发送节点和接收)</li>
<li><code>差错检测</code>(信号衰减和噪声会引起差错)</li>
<li><code>差错纠正</code></li>
<li><code>全双工和半双工通信控制</code></li>
</ul>
<h3 id="差错编码"><a href="#差错编码" class="headerlink" title="差错编码"></a>差错编码</h3><p>原理: D -&gt; DR R为差错检测与纠正比特(冗余比特)<br>差错编码可分为<em>检错码</em>和<em>纠错码</em><br><code>检错码</code>的检错能力: 对于检错码, 如果编码集的<a href="https://zh.wikipedia.org/wiki/%E6%B1%89%E6%98%8E%E8%B7%9D%E7%A6%BB" target="_blank" rel="external">汉明距离</a><code>ds=r+1</code>, 则该差错编码可以检测<code>r</code> 位的差错.<br>例如: {0000, 0101, 1010, 1111}的汉明距离为2, 可以100%检测1比特的差错(1比特的差错一定会变成一个无效编码)<br><code>纠错码</code>的纠错能力: 对于纠错码, 如果编码及的汉明距离<code>ds=2r+1</code>, 则该差错编码可以纠正<code>r</code>位的差错.<br>例如: {000000, 010101, 101010, 111111}的汉明距离为3, 可以纠正1比特的差错(如100010纠正为101010, (纠正成离他最近的正确编码)).</p>
<h4 id="奇偶校验码"><a href="#奇偶校验码" class="headerlink" title="奇偶校验码"></a>奇偶校验码</h4><p><a href="https://zh.wikipedia.org/wiki/%E5%A5%87%E5%81%B6%E6%A0%A1%E9%AA%8C%E4%BD%8D" target="_blank" rel="external">wikipedia</a><br><code>1比特校验位</code> (检测奇数位差错(检错率50%))<br><code>二维奇偶校验</code>(检测奇数位差错, 部分偶数位差错)(纠正在同一行/列的奇数位差错)</p>
<h4 id="internet校验和-checksum"><a href="#internet校验和-checksum" class="headerlink" title="internet校验和(checksum)"></a>internet校验和(checksum)</h4><p>详见传输层-UDP校验和<br>一般放入(UDP, TCP, IP)的校验和字段</p>
<h4 id="循环冗余校验码-CRC"><a href="#循环冗余校验码-CRC" class="headerlink" title="循环冗余校验码(CRC)"></a>循环冗余校验码(CRC)</h4><p>广泛应用于数据链路层,检错能力强大<br><a href="http://fdcwqmst.blog.163.com/blog/static/16406145520109712150424/" target="_blank" rel="external">模2运算</a></p>
<p><code>D</code>: 数据比特<br><code>G</code>: <code>r+1</code>位的比特模式(生成比特模式)<br><code>R</code>: <code>r</code>位的CRC比特</p>
<p>发送方和接收方使用相同的<code>G</code>, 可以检测出所有长度小于r+1的差错<br><code>发送方</code>: 根据D和G计算出R, 将D和R拼接成<code>&lt; D,R&gt;</code>, 即编码结果<br><code>接收方</code>: 将<code>&lt; D,R&gt;</code> 除以G(模2), 余式为0则无错, 否则出错.</p>
<p><code>R</code>的计算方法:<br>首先看<code>编码结果</code>: D左移r位再与R异或(D * 2^r XOR R)<br>这个编码结果可以被G整除, 即: D * 2^r XOR R = nG<br>由于R与D的关系, 上式相当于 D * 2^r = nG XOR R<br>则 R = [D * 2^r / G]的余数</p>
<p>举例:<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">被校验的数据M(x)=<span class="number">1000</span>，</div><div class="line">其选择生成多项式为G(x)=x^<span class="number">3</span>+x+<span class="number">1</span>,</div><div class="line">该数据的循环冗余校验和应为多少？</div><div class="line"></div><div class="line">G(x)=x^<span class="number">3</span>+x+<span class="number">1</span>对应的二进制数为<span class="number">1011</span>，</div><div class="line">且G(x)中含<span class="number">3</span>个项式，</div><div class="line">生成多项式为<span class="number">4</span>位二进制，</div><div class="line">由CRC规则应该取(<span class="number">4</span><span class="number">-1</span>)=<span class="number">3</span>位(校验和)，</div><div class="line">所以可以预加上<span class="number">3</span>位得到<span class="number">1000</span>B*<span class="number">2</span>^<span class="number">3</span>=<span class="number">1000</span> <span class="number">000</span>B;</div><div class="line"></div><div class="line"><span class="number">1000</span> <span class="number">000</span>B（被除数）对<span class="number">1011</span>（除数）做模<span class="number">2</span>除法，</div><div class="line">得到的余数便是<span class="number">101</span>B(即CRC校验和)，</div><div class="line">所以该数据的循环冗余校验后的数据应为<span class="number">1000</span> <span class="number">000</span>B+<span class="number">101</span>B=<span class="number">1000101</span>B。</div></pre></td></tr></table></figure></p>
<h3 id="Multiple-access-links-protocols"><a href="#Multiple-access-links-protocols" class="headerlink" title="Multiple access links , protocols"></a>Multiple access links , protocols</h3><p>two types of links</p>
<ul>
<li>point-to-point</li>
<li>broadcast(shared wire or medium)</li>
</ul>
<p>multiple access protocol</p>
<ul>
<li>distributed algorithm that determines how nodes share channel.</li>
</ul>
<p><strong>MAC protocols: taxonomy</strong></p>
<ul>
<li><p><strong>channel partitioning</strong><br>TDMA: time division multiple access<br>FDMA: frequency division multiple access</p>
</li>
<li><p><strong>random access</strong><br><strong>Slotted ALOHA</strong> (只能在某个时期开始时发, 如果两个节点冲突, 则下次两个节点都以概率p发送, 必须满足时钟同步, 节点必须能够检测到冲突, 效率0.37)<br><strong>Pure(unslotted) ALOHA</strong> (不分时期, 能直接发送, 效率比slotted Aloha更低, 0.18)<br><strong>CSMA</strong>(carrier sense multiple access)(listen before transmit, 也可能冲突)<br><strong>CSMA/CD</strong>(collision detection)(发送数据过程中检测冲突)(Ethernet CSMA/CD algorithm)<br>Lmin / R = 2 <em> S / V<br>800bit / 1Gbps = 2 </em> 80m / 200000Kmps</p>
</li>
<li><p><strong>taking turns</strong><br><strong>polling</strong> (master node invites slave nodes to transmit in turn)<br><strong>token passing</strong> (control token passed from one node to next sequentially)</p>
</li>
</ul>
<h3 id="Lan"><a href="#Lan" class="headerlink" title="Lan"></a>Lan</h3><p><strong>MAC address and ARP</strong></p>
<p>ARP表: LAN 中每个IP节点(主机, 路由器)维护一个表(存储某些LAN节点的IP/MAC地址映射关系)</p>
<p>A想要给<code>同一局域网</code>内的B发送数据包(B的MAC地址不在A的ARP表中)<br>则A<code>广播</code>ARP查询分组, 其中包含B的IP地址(广播的MAC地址=FF-FF-FF-FF-FF-FF)</p>
<h4 id="Ethernet"><a href="#Ethernet" class="headerlink" title="Ethernet"></a>Ethernet</h4><p><strong>bus(总线)</strong> (all nodes in same collision domain)</p>
<p><strong>star(星型)</strong> (each ‘spoke’ runs a Ethernet protocol (nodes do not collid with each other))</p>
<p>以太网: 无连接(没有握手), 不可靠(没有确认)</p>
<p><strong>Ethernet fram structure</strong>(见上 以太网帧结构)<br>preamble(8) des-add(6) sour-add(6) type(2) data(46-1500) CRC(4)<br>Lmin = 64B , data(min) = 64 - 6 - 6 - 2 - 4 = 46B</p>
<h4 id="switches-交换机"><a href="#switches-交换机" class="headerlink" title="switches(交换机)"></a>switches(交换机)</h4><p>存储, 转发以太网帧</p>
<p>识别帧中的MAC 地址, 选择性地转发</p>
<p>Ethernet protocol used on each incoming link, but no collisions; full duplex (each link is its own collision domain)</p>
<p><code>switch table</code> (each entry: MAC address of host, interface to reach host, time stamp)</p>
<p><code>switch: self-learning</code> </p>
<p>网络层路由器设备隔离广播域, 广播的范围为一个IP子网<br><code>注意区分冲突域 和广播域</code></p>
<p><code>交换机 vs 路由器</code><br>都有存储转发<br>路由器: 网络层, routing algorithms, IP addresses<br>交换机: 数据链路层 , learn forwarding table using flooding, learning, MAC addresses</p>
<p><code>summary comparison</code></p>
<table>
<thead>
<tr>
<th>-</th>
<th>hubs</th>
<th>switches</th>
<th>bridges</th>
<th>routers</th>
</tr>
</thead>
<tbody>
<tr>
<td>layer</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>3</td>
</tr>
<tr>
<td>traffic isolation</td>
<td>no</td>
<td>yes</td>
<td>yes</td>
<td>yes </td>
</tr>
<tr>
<td>storm isolation</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>yes</td>
</tr>
<tr>
<td>plug and play</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>no</td>
</tr>
<tr>
<td>optimal routing</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>yes</td>
</tr>
<tr>
<td>cut through</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>no</td>
</tr>
</tbody>
</table>
<h4 id="VLAN"><a href="#VLAN" class="headerlink" title="VLAN"></a>VLAN</h4><p>基于端口的VLAN<br><code>流量隔离</code> (come/from 端口1-8的帧只到达端口1-8)<br><code>动态成员</code> (端口可以动态分配给不同的成员)<br><code>在VLAN间转发</code>(通过路由, 就像在独立的交换机之间)(实践中, 厂商会将交换机和路由器集成在一起,因此不需要另外接路由器)</p>
<p><code>跨越多交换机的VLAN</code><br>多线缆连接(每个线缆连接一个VLAN)<br>中继端口(在跨越多个物理交换机定义的VLAN承载帧)(为多个VLAN转发802.1帧容易产生歧义(必须携带VLAN ID信息))(802.1q协议为经过中继端口转发的帧增加/去除 额外的首部域)</p>
<h3 id="PPP"><a href="#PPP" class="headerlink" title="PPP"></a>PPP</h3><p>one Sender and one Receiver, one link,<br>no Media Access Control,<br>no need for MAC address</p>
<p><strong>packet framing</strong><br><strong>bit transparency</strong><br><strong>error detection</strong><br><strong>connection liveness</strong><br><strong>network layer address negotiation</strong></p>
<p>no error correction/cecovery<br>no flow control<br>out of order delivery OK<br>no need to support multiple links</p>
<p><strong>Byte Stuffing</strong></p>
<h3 id="link-virtualization-MPLS"><a href="#link-virtualization-MPLS" class="headerlink" title="link virtualization: MPLS"></a>link virtualization: MPLS</h3><h2 id="物理层"><a href="#物理层" class="headerlink" title="物理层"></a>物理层</h2><p><strong>channel capacity</strong>(the maximum rate at which data can be transmitted over a given communication path(channel))</p>
<p>Data rate(in bits per second)<br>Bandwidth(in cycles per second of Hertz)</p>
<p><strong>C = 2Blog2M</strong><br>C-channel capacity, B-bandwidth, M-the number of discrete signal<br>example: 带宽3KHz, 采用4个相位, 每个相位4种振幅的QAM调制技术, 则该通信链路的最大数据传输速率是: <strong>24 kbps</strong><br>2 <em> 4 </em> log2 16 = 24</p>
<p><strong>Shannon Capacity Formulation</strong><br><strong>C=Blog2 (1 + S / N)</strong><br>S/N - signal-to-noise ratio信噪比</p>
<p>S/N is often reported in descibels (<strong>dB</strong>)<br>(S/N)db = 10log10 (S / N)</p>
<p><code>Data Rate(Bit rate-R)</code>(Rate of data transmission in bits per second)<br><code>Modulation rate(Baud rate-B)</code>(Rate at width the signal level changes)<br><code>R = Blog2 M</code>(M-Number of states of code element)</p>
<p><code>Pulse Code Modulation(PCM)</code>(脉冲编码调制)</p>
<p><code>Spread Spectrum</code> (扩频)</p>
<p><code>异步/同步 传输</code>(异步: start bits, stop bits)(同步: 单独的时钟线, 或者将时钟信号嵌入到数据中)</p>
<p><code>Media</code></p>
<p><code>Interfacing</code></p>
<hr>
<h2 id="无线与移动网络"><a href="#无线与移动网络" class="headerlink" title="无线与移动网络"></a>无线与移动网络</h2><h3 id="wireless"><a href="#wireless" class="headerlink" title="wireless"></a>wireless</h3><p><code>wireless link</code>(无线链路)<br>(信号随距离衰减)(容易受干扰)()</p>
<p>信噪比低, 误码率高(SNR versus BER tradeoffs)</p>
<p>multiple access 可能遇到的问题<br><code>Hidden terminal problem</code>(障碍物导致的隐藏终端问题)<br><code>Signal attenuation</code>(信号衰减导致的问题)</p>
<p><code>CDMA</code>(码分多址)(每个用户分配不同的码片序列)</p>
<h4 id="802-11"><a href="#802-11" class="headerlink" title="802.11"></a>802.11</h4><p><strong>IEEE 802.11 Wireless LAN</strong>(WiFi)</p>
<ul>
<li>802.11b</li>
<li>802.11a</li>
<li>802.11g</li>
<li>802.11n (multiple antennae)(2.4-2.5 GHz range)(up to 600Mbs)</li>
</ul>
<blockquote>
<p>MIMO (多输入多输出)</p>
<p>OFDM (正交频分多路)</p>
</blockquote>
<p>base station = access point (ap)</p>
<p><code>BSS</code>(basic service set)(基站子系统)</p>
<p><code>SSID</code></p>
<p>host: must <em>associate</em> with an AP</p>
<p><strong>multiple access</strong>(可能产生的冲突问题)<br>CSMA - sense before transmitting<br>no collision dection(not CSMA/CD), use CSMA/CA(collision avoidance)(不能完全避免冲突, 能避免数据帧冲突)<br>发送端: 监听信道, 如果信道空闲, 且空闲了<strong>DIFS(分布式帧间间隙, 根据优先级有不同的时间间隙)</strong>时间, 则发送数据; 如果信道忙, 则启动随机的backoff time, 等信道空闲则启动倒计时, 倒计时结束后信道空闲则发送数据.<br>接收端: 如果接收到数据完成, 等待<strong>SIFS</strong>时间后返回ACK<br>避免冲突: 发送方先给BS发送一个<strong>RTS</strong>(request-to-send)包(使用CSMA), BS广播一个<strong>CTS</strong>作为RTS的回应; CTS被所有的节点监听到, 这样其他的节点就不会发送数据</p>
<p><code>AP不需要IP地址, 其为链路层设备</code></p>
<p>802.11 frame MTU 2312</p>
<h4 id="Cellular-Internet-access"><a href="#Cellular-Internet-access" class="headerlink" title="Cellular Internet access"></a>Cellular Internet access</h4><h3 id="mobility"><a href="#mobility" class="headerlink" title="mobility"></a>mobility</h3><p>mobile IP<br><code>home network</code> <code>home agent</code> <code>permanent address</code><br><code>visited network</code> <code>foreign agent</code> <code>care-of-address</code></p>
<p>GSM<br><code>home network</code> <code>home location register (HLR)</code> <code>visited network</code> <code>visitor location register(VLR)</code></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/notes/" rel="tag">#notes</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/09/06/JS-超长数字的坑/" rel="next" title="JS 超长数字的坑">
                <i class="fa fa-chevron-left"></i> JS 超长数字的坑
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/09/14/编译原理2E-笔记/" rel="prev" title="编译原理2E-笔记">
                编译原理2E-笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/09/11/计算机网络-笔记/"
           data-title="计算机网络-笔记" data-url="https://beim.github.io/2016/09/11/计算机网络-笔记/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/hand_zheng.jpg"
               alt="Beim" />
          <p class="site-author-name" itemprop="name">Beim</p>
          <p class="site-description motion-element" itemprop="description">平常心，平常心。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">33</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0"><span class="nav-number">1.</span> <span class="nav-text">0</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#答案暂存"><span class="nav-number">1.1.</span> <span class="nav-text">答案暂存</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#计算机网络5E"><span class="nav-number">2.</span> <span class="nav-text">计算机网络5E</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#关键字"><span class="nav-number">2.1.</span> <span class="nav-text">关键字</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#报文格式"><span class="nav-number">2.2.</span> <span class="nav-text">报文格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OSI参考模型"><span class="nav-number">2.3.</span> <span class="nav-text">OSI参考模型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TCP-IP-参考模型"><span class="nav-number">2.4.</span> <span class="nav-text">TCP/IP 参考模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#设计目标"><span class="nav-number">2.4.1.</span> <span class="nav-text">设计目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模型结构"><span class="nav-number">2.4.2.</span> <span class="nav-text">模型结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-IP-模型及协议"><span class="nav-number">2.4.3.</span> <span class="nav-text">TCP/IP 模型及协议</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#套接字编程实例-Internet-文件服务器"><span class="nav-number">2.5.</span> <span class="nav-text">套接字编程实例: Internet 文件服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#路由算法"><span class="nav-number">2.6.</span> <span class="nav-text">路由算法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#计算机网络课程"><span class="nav-number">3.</span> <span class="nav-text">计算机网络课程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#第二周-1-4计算机网络性能"><span class="nav-number">3.1.</span> <span class="nav-text">第二周-1.4计算机网络性能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#四种分组延迟"><span class="nav-number">3.1.1.</span> <span class="nav-text">四种分组延迟</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第5周-传输层-上"><span class="nav-number">3.2.</span> <span class="nav-text">第5周 传输层(上)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UDP-校验和-checksum"><span class="nav-number">3.2.1.</span> <span class="nav-text">UDP 校验和(checksum)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第6周-传输层-下"><span class="nav-number">3.3.</span> <span class="nav-text">第6周 传输层(下)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第7周-网络层-上"><span class="nav-number">3.4.</span> <span class="nav-text">第7周 网络层(上)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第8周-网络层-下"><span class="nav-number">3.5.</span> <span class="nav-text">第8周 网络层(下)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#链路层"><span class="nav-number">3.6.</span> <span class="nav-text">链路层</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#链路层服务"><span class="nav-number">3.6.1.</span> <span class="nav-text">链路层服务:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#差错编码"><span class="nav-number">3.6.2.</span> <span class="nav-text">差错编码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#奇偶校验码"><span class="nav-number">3.6.2.1.</span> <span class="nav-text">奇偶校验码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#internet校验和-checksum"><span class="nav-number">3.6.2.2.</span> <span class="nav-text">internet校验和(checksum)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#循环冗余校验码-CRC"><span class="nav-number">3.6.2.3.</span> <span class="nav-text">循环冗余校验码(CRC)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multiple-access-links-protocols"><span class="nav-number">3.6.3.</span> <span class="nav-text">Multiple access links , protocols</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lan"><span class="nav-number">3.6.4.</span> <span class="nav-text">Lan</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Ethernet"><span class="nav-number">3.6.4.1.</span> <span class="nav-text">Ethernet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#switches-交换机"><span class="nav-number">3.6.4.2.</span> <span class="nav-text">switches(交换机)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#VLAN"><span class="nav-number">3.6.4.3.</span> <span class="nav-text">VLAN</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PPP"><span class="nav-number">3.6.5.</span> <span class="nav-text">PPP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#link-virtualization-MPLS"><span class="nav-number">3.6.6.</span> <span class="nav-text">link virtualization: MPLS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#物理层"><span class="nav-number">3.7.</span> <span class="nav-text">物理层</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#无线与移动网络"><span class="nav-number">3.8.</span> <span class="nav-text">无线与移动网络</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#wireless"><span class="nav-number">3.8.1.</span> <span class="nav-text">wireless</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#802-11"><span class="nav-number">3.8.1.1.</span> <span class="nav-text">802.11</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cellular-Internet-access"><span class="nav-number">3.8.1.2.</span> <span class="nav-text">Cellular Internet access</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mobility"><span class="nav-number">3.8.2.</span> <span class="nav-text">mobility</span></a></li></ol></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Beim</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script>

  
  <script type="text/javascript" src="https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js"></script>

  
  <script type="text/javascript" src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script>

  
  <script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.min.js"></script>

  
  <script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.ui.min.js"></script>

  
  <script type="text/javascript" src="https://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"beim"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="https://cdn.bootcss.com/UAParser.js/0.7.9/ua-parser.min.js"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("QpR0wBRCIFVoU9r2x7ydx4hF-gzGzoHsz", "BRWqoRltsGqh4f0nUiW0EIPA");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
